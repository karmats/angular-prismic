/**
 * 
 * @version v0.0.0 - 2014-05-06
 * @link 
 * @author 
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */angular.module("prismic.io",[]).factory("PrismicRequestHandler",["$http",function(a){return function(b,c){a.get(b).then(function(a){c(a.data)})}}]).provider("Prismic",function(){this.$get=["$http","$window","PrismicRequestHandler","$q",function(a,b,c,d){var e=c,f=b.Prismic,g="",h=function(a){g=a},i="",j=function(a){i=a},k="",l=function(a){k=a},m="",n=function(a){m=a},o=function(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))};b=e.exec(a);)c[f(b[1])]=f(b[2]);return c},p=function(a){f.Api(m,a,g,e)},q=function(a,b){p(function(c){var d={ref:a||c.refs[0].ref,api:c,maybeRef:a&&a!=c.refs[0].ref?a:"",maybeRefParam:a&&a!=c.refs[0].ref?"&ref="+a:"",oauth:function(){var a=g;return{accessToken:a,hasPrivilegedAccess:!!a}},linkResolver:function(a){return"detail.html?id="+a.id+"&slug="+a.slug+d.maybeRefParam}};b(d)})},r=function(a){q(s.ref,function(b){a.apply(window,[b])})},s=o(window.location.search.substring(1)),t=(o(window.location.hash.substring(1)),function(){var b=d.defer();return r(function(c){console.log(c),a.get(c.api.forms.everything.action,{params:{ref:c.ref}}).then(function(a){b.resolve(a.data.results)})}),b.promise}),u=function(b){var c=d.defer();return r(function(d){a.get(d.api.forms.everything.action,{params:{ref:d.ref,q:b}}).then(function(a){c.resolve(a.data.results)})}),c.promise};return{setAccessToken:h,setClientId:j,setClientSecret:l,setAPIEndpoint:n,get:t,query:u}}]});